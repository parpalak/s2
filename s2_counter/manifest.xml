<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE extension SYSTEM "ext-1.0.dtd">
<!--
/**
 * Counter
 *
 * Adds a simple hits/hosts and RSS subscribers counter.
 *
 * @copyright (C) 2007-2011 Roman Parpalak
 * @license http://www.gnu.org/licenses/gpl.html GPL version 2 or higher
 * @package s2_counter
 */
-->

<extension for="S2" engine="1.0">
	<id>s2_counter</id>
	<title>Counter</title>
	<version>1.0a</version>
	<description>A simple hits/hosts and RSS subscribers counter.</description>
	<author>Roman Parpalak</author>

	<minversion>1.0a1</minversion>
	<maxtestedon>1.0a1</maxtestedon>

	<hooks>

		<hook id="fn_404_header_start"><![CDATA[
global $s2_counter_skip;
$s2_counter_skip = true;
		]]></hook>

		<hook id="idx_template_pre_replace"><![CDATA[
if (!isset($s2_counter_skip) || !$s2_counter_skip)
{
	if (!defined('S2_COUNTER_FUNCTIONS_LOADED'))
		include $ext_info['path'].'/functions.php';

	s2_counter_process($ext_info['path']);
}
$replace['<!-- s2_counter_img -->'] = '<img class="s2_counter" src="'.$ext_info['url'].'/counter.php" width="88" height="31" />';
		]]></hook>

		<hook id="fn_do_rss_start"><![CDATA[
if (!defined('S2_COUNTER_FUNCTIONS_LOADED'))
	include $ext_info['path'].'/functions.php';

s2_counter_rss_count($ext_info['path']);
		]]></hook>

		<hook id="ai_head_end"><![CDATA[
echo '<script type="text/javascript" src="'.$ext_info['url'].'/amstock/swfobject.js"></script>'."\n";
echo '<script type="text/javascript" src="'.$ext_info['url'].'/draw_chart.js"></script>'."\n";
		]]></hook>

		<hook id="fn_stat_info_end"><![CDATA[
$output .= '<fieldset><legend>Traffic</legend><div id="s2_counter_hits"><strong>You need to upgrade your Flash Player in order to view graphs.</strong></div></fieldset>';
$output .= '<fieldset><legend>RSS readers</legend><div id="s2_counter_rss"><strong>You need to upgrade your Flash Player in order to view graphs.</strong></div></fieldset>';
s2_add_js_header_delayed('s2_counter_draw_chart();');
		]]></hook>

	</hooks>
</extension>
